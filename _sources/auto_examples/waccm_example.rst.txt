
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/waccm_example.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_waccm_example.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_waccm_example.py:


WACCM LBC for CMAQ
================================

This example shows how to use aqmbc with WACCM's publicly available forecasts.

* Download from waccm (only if not available in WACCM folder).
* Define translation.
* Extract and translate.
* Display figures and statistics.

.. GENERATED FROM PYTHON SOURCE LINES 11-19

.. code-block:: default


    from os.path import basename
    import aqmbc
    import matplotlib.pyplot as plt
    import glob

    gdnam = '12US1'


.. GENERATED FROM PYTHON SOURCE LINES 20-22

Download from waccm via HTTP
----------------------------

.. GENERATED FROM PYTHON SOURCE LINES 22-27

.. code-block:: default


    dates = ['2023-04-15', '2023-07-15']

    aqmbc.models.waccm.download(dates)


.. GENERATED FROM PYTHON SOURCE LINES 28-30

Define Translation Expressions
------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 30-34

.. code-block:: default


    # In Notebooks, display available expressions
    aqmbc.exprlib.avail('waccm')


.. GENERATED FROM PYTHON SOURCE LINES 35-42

.. code-block:: default


    exprpaths = aqmbc.exprlib.exprpaths([
        'waccm_o3so4.expr'                     # for full run, comment this
        # 'waccm_met.expr', 'waccm_cb6.expr',  # for full run, uncomment this
        # 'waccm_ae7.expr'                     # for full run, uncomment this
    ], prefix='waccm')


.. GENERATED FROM PYTHON SOURCE LINES 43-45

Translate WACCM for use by CMAQ
-------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 45-65

.. code-block:: default


    # For "real" VGLVLS use
    # METBDYD_PATH = '...'
    # metaf = pnc.pncopen(METBDY3D_PATH, format='ioapi')
    metaf = aqmbc.options.getmetaf(bctype='bcon', gdnam=gdnam, vgnam='EPA_35L')
    inpaths = sorted(glob.glob('WACCM/f.e22*.nc'))
    bcpaths = []
    suffix = f'_{gdnam}_BCON.nc'
    gcdims = aqmbc.options.dims['waccm']
    for inpath in inpaths:
        print(inpath, flush=True)
        outpath = basename(inpath).replace('.nc', suffix)
        history = f'From {outpath}'
        outf = aqmbc.bc(
            inpath, outpath, metaf, vmethod='linear', exprpaths=exprpaths,
            dimkeys=gcdims, format_kw={'format': 'waccm'}, history=history,
            clobber=True, verbose=0
        )
        bcpaths.append(outpath)


.. GENERATED FROM PYTHON SOURCE LINES 66-68

Figures and Statistics
----------------------

.. GENERATED FROM PYTHON SOURCE LINES 68-73

.. code-block:: default


    vprof = aqmbc.report.get_vertprof(bcpaths)
    statdf = aqmbc.report.getstats(bcpaths)
    statdf.to_csv('waccm_summary.csv')


.. GENERATED FROM PYTHON SOURCE LINES 74-76

Visualize Vertical Profiles
---------------------------

.. GENERATED FROM PYTHON SOURCE LINES 76-81

.. code-block:: default


    fig = aqmbc.report.plot_2spc_vprof(vprof)
    fig.suptitle('WACCM Boundary Conditions for CMAQ')
    fig.savefig('waccm_profiles.png')


.. GENERATED FROM PYTHON SOURCE LINES 82-84

Barplot of Concentrations
-------------------------

.. GENERATED FROM PYTHON SOURCE LINES 84-87

.. code-block:: default


    fig = aqmbc.report.plot_gaspm_bars(statdf)
    fig.savefig('waccm_bar.png')


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.000 seconds)


.. _sphx_glr_download_auto_examples_waccm_example.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: waccm_example.py <waccm_example.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: waccm_example.ipynb <waccm_example.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
